module.exports = async ({ 
    print,
    generate, 
    packageManager, 
    options: { 
        name = 'herbs-project', 
        description = 'project generated by herbs CLI S2', 
        author = 'herbs CLI', 
        license = 'MIT',
        mongo = false,
        postgres = false,
        yarn = false
    }
}) => async () => { 
    let migration = postgres ? `,
      "knex:make": "npx knex --knexfile knexfile.js migrate:make",
      "knex:migrate": "npx knex --knexfile knexfile.js migrate:latest",
      "knex:rollback": "npx knex --knexfile knexfile.js migrate:rollback",
      "knex:makeSeeds": "npx knex --knexfile knexfile.js seed:make",
      "knex:runSeeds": "npx knex --knexfile knexfile.js seed:run"` : ''

    await generate({
        template: 'package.json.ejs',
        target: `package.json`,
        props: {
            name, description, author, license, migration
        }
    })
    const opt = { force: 'npm'}
    if(yarn) {
        if(packageManager.hasYarn())
            opt.force = 'yarn'
        else {
            print.warn('You don\'t have yarn installed')
        }
    }
    await packageManager.add(['buchu', 'gotu', 'deepmerge'], opt)

    const packages = [
        'herbs2gql',
        'graphql',
        'apollo-server-express',
        'apollo-server',
        'sugar-env',
        'dotenv',
        'herbsshelf',
        'herbs2rest',
        'graphql-tools',
        'nodemon']

    if(mongo) 
        packages.push('mongodb')
    if(postgres){
        packages.push('herbs2knex')
        packages.push('pg')
    }
    opt.dryRun = true
    await packageManager.add(['buchu', 'gotu', 'deepmerge'], opt)

}

